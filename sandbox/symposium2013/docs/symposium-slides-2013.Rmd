% Constructing Portfolios of Dynamic Strategies using Downside Risk Measures
% Peter Carl, Hedge Fund Strategies, William Blair & Co.
% November 11, 2013

<!---
# HOWTO
To create PDF of these slides:
$ pandoc symposium-slides-2013.Rmd -t beamer -o slides.pdf

This is an R Markdown document. Markdown is a simple formatting syntax for authoring web pages (click the **MD** toolbar button for help on Markdown).  Or see: http://daringfireball.net/projects/markdown/syntax

When you click the **Knit HTML** button a web page will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
summary(cars)
```

You can also embed plots, for example:

```{r fig.width=7, fig.height=6}
plot(cars)
```
-->

# Introduction

- Discuss the challenges of constructing hedge fund portfolios
- Offer a framework for considering strategic allocation of hedge funds
- Discuss various methods of evaluating portfolio objectives
- Show the relative performance of multiple objectives
- Discuss extensions to the framework

# Objectives

- Identify several sets of objectives to establish benchmark and target portfolios 
- Evaluate complex constraints, including some that equalize or budget risks using downside measures of risk
- Visualize portfolio problems to build intuition about objectives and constraints
- Use analytic solvers and parallel computation as problems get more complex
<!-- 
- Rebalancing periodically and examining out of sample performance will help refine objectives
-->

<!-- Can't think of a reason to do this:
# Process
Insert process diagram here? Optional
-->

# Strategic allocation
...broadly described as periodically reallocating the portfolio to achieve a long-term goal

- Understand the nature and sources of investment risk within the portfolio
- Manage the resulting balance of risk and return of the portfolio
- Apply within the context of the current economic and market situation
- Think systematically about preferences and constraints

<!-- This slide is tired:
# Portfolio issues
Markowitz (1952) described an investor's objectives as:

* maximizing some measure of gain while
* minimizing some measure of risk

Many approaches follow Markowitz by using variance of returns for "risk"
-->

# Portfolio preferences
Construct a portfolio that:

* maximizes return,
* with per-asset position limits,
* with a specific univariate portfolio risk limit,
* defining risk as losses,
* considering effects of skewness and kurtosis,
* and limiting contribution of risk for constituents 
* or equalizing component risk contribution.

<!-- Not a quadratic (or linear, or conical) problem any more. -->

# Optimization frustration
Most investors would prefer:

* to be approximately correct rather than precisely wrong
* to define risk as potential loss rather than volatility
* the flexibility to define any kind of objective and combine the constraints
* a framework for considering different sets of portfolio constraints for comparison through time
* to intuitively understand optimization through visualization

# Risk budgeting
* Used to allocate the "risk" of a portfolio 
* Decomposes the total portfolio risk into the risk contribution of each component position
* Literature on risk contribution has focused on volatility rather than downside risk
* Most financial returns series seem non-normal

<--! Two-column slide with a facing histogram and qqplot -->

# Measuring risk, not volatility
Measured with portfolio Conditional Value-at-Risk (CVaR)

* Also called Expected Tail Loss (ETL) and Expected Shortfall (ES)
* ETL is the mean expected loss when the loss exceeds the VaR
* ETL has all the properties a risk measure should have to be coherent and is a convex function of the portfolio weights
* To account for skew and/or kurtosis, use Cornish-Fisher (or "modified") estimates of ETL instead (mETL)

<!--- Same histogram/qqplot as prior slide with mVaR and mETL marked -->

# ETL sensitivity
Modified ETL demonstrates a better fit for historical CVaR at lower confidence levels, and can break down at higher confidence levels
*Insert chart or charts*

<!-- discuss cleaning? -->

# _Ex ante_, not _ex post_
The use of _ex ante_ risk budgets is more recent

* Qian (2005): "risk parity portfolio" allocates portfolio variance equally
* Maillard _et al_ (2010): "equally-weighted risk contribution portfolio" or (ERC)
* Zhu _et al_ (2010): optimal mean-variance portfolio selection under constrained contributions

We want to look at the allocation of risk through _ex ante_ downside risk contribution

# Contribution to downside risk, not volatility
Use the modified CVaR contribution estimator from Boudt, _et al_ (2008)

* CVaR contributions correspond to the conditional expectation of the return of the portfolio component when the portfolio loss is larger than its VaR loss.
* %CmETL is the ratio of the expected return on the position when the portfolio experiences a beyond-VaR loss to the expected value of the portfolio loss
* A high positive %CmETL indicates the position has a large loss when the portfolio also has a large loss
* The higher the percentage mETL, the more the portfolio downside risk is concentrated on that asset
* Allows us to directly optimize downside risk diversification
* Lends itself to a simple algorithm that computes both CVaR and component CVaR in less than a second, even for large portfolios

We can use CVaR contributions as an objective or constraint in portfolio optimization

# Two strategies for using downside contribution in allocation
## Equalize downside risk contribution

* Define downside risk diversification as an objective

## Downside risk budget

* Impose bound constraints on the percentage mETL contributions


# An example
describe the example as a case study

# Selected hedge fund strategies
Monthly data of EDHEC hedge fund indexes from 1998

## Relative Value

* Fixed Income Arb
* Convertible Arb
* Equity Market Neutral
* Event Driven

## Directional

* Equity Long/Short
* Global Macro
* CTA

# Ex-post Performance
\includegraphics[width=1.0\textwidth]{../results/EDHEC-Cumulative-Returns.png}

# Ex-post Performance
\includegraphics[width=1.0\textwidth]{../results/EDHEC-BarVaR.png}

# Ex-post Performance
\includegraphics[width=1.0\textwidth]{../results/EDHEC-RollPerf.png}

# Ex-post Performance
\includegraphics[width=0.5\textwidth]{../results/EDHEC-ScatterSinceIncept.png}
\includegraphics[width=0.5\textwidth]{../results/EDHEC-Scatter36m.png}

# Ex-post Performance
\includegraphics[width=1.0\textwidth]{../results/EDHEC-Distributions.png}

# Ex-post Performance
Add table of relevant statistics here

# Ex-post Correlations
\includegraphics[width=0.5\textwidth]{../results/EDHEC-cor-inception.png}
\includegraphics[width=0.5\textwidth]{../results/EDHEC-cor-tr36m.png}

# Add general constraints
Constraints specified for each asset in the portfolio:

* Maximum position: 30%
* Minimum position: 5%
* Weights sum to 100%
* Group constraints
* Rebalancing quarterly

# Estimation

<!--- Say something meaningful here -->

* Optimizer chooses portfolios based on forward looking estimates of risk and return based on the portfolio moments
* Usually explicitly making trade-offs between correlation and volatility among members 
* Modified ETL extends the tradeoffs to the first four moments and co-moments
* Historical sample moments work fine as predictors in normal market regimes, but poorly when the market regime shifts

One of the largest challenges in optimization is improving the estimates of the moments

# Forecasting
## Returns

## Volatility

## Correlation


# Multiple objectives

Equal contribution to:

* weight
* variance
* risk
  
Reward to risk:

* mean-variance
* mean-modified ETL

Minimum:

* variance
* modified ETL

<!-- Most of these are obvious, so just describe verbally on the prior slide
# Equal contribution...
...to Weight

* Implies diversification but has nothing to say about returns or risk

...to Variance

* Allocates portfolio variance equally across the portfolio components

...to Risk

* Use (percentage) ETL contributions to directly diversify downside risk among components
* Actually the minimum concentration component risk contribution portfolio

# Reward to risk ratios...
...mean/variance

* A traditional reward to risk objective that penalizes upside volatility as risk

...mean/modified ETL

* A reward-to-downside-risk objective that uses higher moments to estimate the tail

# Minimum...
...variance

* The portfolio with the forecasted variance of return

...ETL

* The portfolio with the minimum forecasted ETL

Minimum risk portfolios generally suffer from the drawback of portfolio concentration.
-->
<!-- Only two of these deserve more discussion -->

# Equal-weight portfolio

* Provides a benchmark to evaluate the performance of an optimized portfolio against
* Each asset in the portfolio is purchased in the same quantity at the beginning of the period
* The portfolio is rebalanced back to equal weight at the beginning of the next period
* Implies no information about return or risk
* Is the re-weighting adding or subtracting value?
* Do we have a useful view of return and risk?

# Contribution of Risk in Equal Weight Portfolio
insert table

# Equal Contribution to Risk
The risk parity constraint that requires all assets to contribute to risk equally is usually too restrictive.

* Use the Minimum Concentration Component (MCC) risk contribution portfolio as an objective
* Minimize the largest ETL risk contribution in the portfolio
* Unconstrained, the MCC generates similar portfolios to the risk parity portfolio
* The MCC can, however, be more easily be combined with other objectives and constraints

<!--- Insert more on the methodology for equal contribution to ETL -->

# Constrained Risk Contribution
Risk Budget as an eighth objective?



<!--- METHODS -->

# Optimizers
## Closed-form

* add list from PortfA
* discuss stress testing briefly

## Heuristic

* Random portfolios
* Differential evolution
* Others

# Random Portfolios
[Burns (2009)](http://www.portfolioprobe.com/blog/) describes Random Portfolios

* From a portfolio seed, generate random pemutations of weights that meet your constraints on each asset
* add more here
* Random portfolios with X000 permutations

Sampling can help provide insight into the goals and constraints of the optimization

* Covers the 'edge case' (min/max) constraints well
* Covers the 'interior' portfolios
* Useful for finding the search space for an optimizer
* Allows arbitrary number of samples
* Allows massively parallel execution

# Sampled portfolios
scatter chart with equal weight portfolio

# Turnover from equal-weight
scatter chart colored by degree of turnover

# Sampled portfolios
add assets to scatter - overconstrained?

# Constrain by contribution to mETL
Add a constraint

# Differential Evolution
All numerical optimizations are a tradeoff between speed and accuracy

This space may well be non-convex in real portfolios

Differential evolution will get more directed with each generation, rather than the uniform search of random portfolios

Allows more logical 'space' to be searched with the same number of trial portfolios for more complex objectives

doesn't test many portfolios on the interior of the portfolio space

Early generations search a wider space; later generations increasingly focus on the space that is near-optimal

Random jumps are performed in every generation to avoid local minima

*Insert Chart*

# Other Heuristic Methods
GenSA, SOMA, 
Such functions are very compute intensive â€“ so linear, quadradic or conical objectives are better addressed through closed-form optimizers

However, many business objectives do not fall into those categories...

...and brute force solutions are often intractable

<!--- RESULTS -->

# Ex-ante results
scatter plot with multiple objectives

# Ex-ante results
Unstacked bar chart comparing allocations across objectives

# Ex-ante vs. ex-post results
scatter plot with both overlaid

# Out-of-sample results
timeseries charts for cumulative return and drawdown

# Risk contribution
stacked bar chart of risk contribution through time (ex ante and ex post)

# Conclusions
As a framework for strategic allocation:

* Random Portfolios can help you build intuition about your objectives and constraints
* Rebalancing periodically and examining out of sample performance can help you refine objectives
* Differential Optimization and parallelization are valuable as objectives get more complicated


# _PortfolioAnalytics_

- Provides numerical solutions to portfolios with complex constraints and objectives comprised of any function
- Unifies the interface across different numerical and closed-form optimizers, including ... *ADD LIST*
- Implements a front-end to two analytical solvers: **Differential Evolution** and **Random Portfolios**
- Preserves the flexibility to define any kind of objective and constraint
- Work-in-progress, available on R-Forge in the _ReturnAnalytics_ project


# Other packages

## _PerformanceAnalytics_
  * Returns-based analysis of performance and risk for financial instruments and portfolios

## _ROI_
  * Infrastructure package for optimization that facilitates use of different solvers by K. Hornik, D. Meyer, and S. Theussl
  
## _DEoptim_
  * Implements Differential Evolution, a very powerful, elegant, population based stochastic function minimizer
  
## _xts_
  * Time series package specifically for finance by Jeff Ryan and Josh Ulrich


# Thanks
* Brian Peterson
* Kris Boudt
* Doug Martin
* Ross Bennett

# References
Figure out bibtex links in markup

# Appendix
Slides after this point are not likely to be included in the final presentation

# Scratch
Slides likely to be deleted after this point